{
  "csar_name": "wordpress",

  "node_types": {
    "SSHContainer": { "$toscafy.embedFileAsJson": "../../node_types/sshcontainer.csarspec.json", "part": "node_types.SSHContainer" },

    "Subversion": {
      "operations": {
        "install": {
          "type": "any2api",
          "artifact_name": "install-svn",
          "properties": {
            "parameters": {
              "cmd": "apt-get update -y && apt-get install -y subversion"
            },
            "results": [ "stdout", "stderr" ]
          }
        }
      }
    },

    "Nodejs": {
      "operations": {
        "install": {
          "type": "any2api",
          "artifact_name": "install-nodejs",
          "properties": {
            "parameters": {
              "cmd": "apt-get update -y && apt-get install -y curl && curl -sL https://deb.nodesource.com/setup_4.x | bash - && apt-get install -y nodejs build-essential && npm install -g npm"
            },
            "results": [ "stdout", "stderr" ]
          }
        }
      }
    },

    "Grunt": {
      "operations": {
        "install": {
          "type": "any2api",
          "artifact_name": "install-grunt",
          "properties": {
            "parameters": {
              "cmd": "npm install -g grunt-cli"
            },
            "results": [ "stdout", "stderr" ]
          }
        }
      }
    },

    "PHPUnit": {
      "operations": {
        "install": {
          "type": "any2api",
          "artifact_name": "install-phpunit",
          "properties": {
            "parameters": {
              "cmd": "apt-get update -y && apt-get install -y phpunit"
            },
            "results": [ "stdout", "stderr" ]
          }
        }
      }
    },

    "MySQL": {
      "operations": {
        "install": {
          "type": "any2api",
          "artifact_name": "install-mysql",
          "properties": {
            "parameters": {
              "cmd": "export DEBIAN_FRONTEND=noninteractive && apt-get update -y && apt-get install -y php5-mysql mysql-server"
            },
            "results": [ "stdout", "stderr" ]
          }
        }
      }
    },

    "WordPress-Build": {
      "operations": {
        "build": {
          "type": "any2api",
          "artifact_name": "build-wordpress",
          "properties": {
            "parameters": {
              "cmd": "svn co http://develop.svn.wordpress.org/tags/4.5 && cd 4.5 && npm install && grunt build"
            },
            "results": [ "stdout", "stderr" ]
          }
        }
      }
    },

    "WordPress-Test": {
      "operations": {
        "test": {
          "type": "any2api",
          "artifact_name": "test-wordpress",
          "properties": {
            "parameters": {
              "cmd": "cd 4.5 && apt-get update -y && apt-get install -y libfontconfig && cp wp-tests-config-sample.php wp-tests-config.php && sed -i \"s/youremptytestdbnamehere/wordpress_tests/\" wp-tests-config.php && sed -i \"s/yourusernamehere/root/\" wp-tests-config.php && sed -i \"s/yourpasswordhere//\" wp-tests-config.php && service mysql start && mysql -e \"CREATE DATABASE wordpress_tests;\" -uroot && grunt --force test"
            },
            "results": [ "stdout", "stderr" ]
          }
        }
      }
    }
  },

  "topology": {
    "name": "wordpress-build-test",
    "nodes": {
      "build-test-container": {
        "type": "SSHContainer"
      },
      "svn": {
        "type": "Subversion",
        "relationships": [
          { "type": "HostedOn", "target": "build-test-container" }
        ]
      },
      "nodejs": {
        "type": "Nodejs",
        "relationships": [
          { "type": "HostedOn", "target": "build-test-container" }
        ]
      },
      "grunt": {
        "type": "Grunt",
        "relationships": [
          { "type": "HostedOn", "target": "build-test-container" },
          "nodejs"
        ]
      },
      "phpunit": {
        "type": "PHPUnit",
        "relationships": [
          { "type": "HostedOn", "target": "build-test-container" }
        ]
      },
      "mysql": {
        "type": "MySQL",
        "relationships": [
          { "type": "HostedOn", "target": "build-test-container" }
        ]
      },
      "wordpress-build": {
        "type": "WordPress-Build",
        "relationships": [
          { "type": "HostedOn", "target": "build-test-container" },
          "svn", "nodejs", "grunt"
        ]
      },
      "wordpress-test": {
        "type": "WordPress-Test",
        "relationships": [
          { "type": "HostedOn", "target": "build-test-container" },
          "nodejs", "grunt", "phpunit", "mysql"
        ]
      }
    }
  }
}
